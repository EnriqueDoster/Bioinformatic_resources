# Load AMR++ resistome data into phyloseq object####

# Read in AMR count matrix ####
# V3 results with SNP confirmation
amr_data <- read.table('data/deduped_AMR_analytic_matrix.csv', header=T, row.names=1, sep=',', quote = "")
# convert this into an 'otu_table' format required for phyloseq
amr_data <- otu_table(amr_data, taxa_are_rows = T)

# Read in gene annotations ####
annotations <- read.table('data/megares_annotations_v3.00.csv', header=T, row.names=1, sep=",", quote = "")
#convert this into a 'taxonomy table' format required for phyloseq
annotations <- phyloseq::tax_table(as.matrix(annotations))

# Read in Sample metadata ####
amr_metadata <- read.table('data/grayson_TE_metadata.csv', header=T, sep=',', row.names = 1)
# convert to 'sample_data' format for phyloseq
amr_metadata <- sample_data(amr_metadata)

# Merge annotations, count matrix, and metadata into a phyloseq object ####
AMR_data.ps <- merge_phyloseq(amr_data, annotations, amr_metadata)



# Remove Rinsate Pools
# AMR_data.ps <- subset_samples(AMR_data.ps, sample_type != "Rinsate Pool")
# AMR_data.ps # 216 samples
# 
# 
# # #### splitting of the genes requiring SNP confirmation
# SNPconfirm <- subset_taxa(AMR_data.ps, snp=="RequiresSNPConfirmation")
# SNPconfirm # 319 of the 2912 genes require SNP confirmation
# 
# data_noSNP <- subset_taxa(AMR_data.ps, snp!="RequiresSNPConfirmation")
# data_noSNP # 2593 genes remain
# 
# 
# # Check sample sums
# sort(sample_sums(AMR_data.ps))




# Make metadata file to use later
AMR_mapfile <- sample_data(AMR_data.ps)

